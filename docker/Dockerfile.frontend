# syntax=docker/dockerfile:1.6

# --- Build stage ---
FROM node:20-alpine AS build
WORKDIR /app
ENV CI=true
ARG VITE_BACKEND_URL
ENV VITE_BACKEND_URL=${VITE_BACKEND_URL}

# Install dependencies
COPY frontend/package*.json ./
RUN npm ci

# Build
COPY frontend/ ./
RUN npm run build

# --- Runtime stage ---
FROM nginx:1.27-alpine AS runtime

# Copy built assets
COPY --from=build /app/dist /usr/share/nginx/html

# Use default Nginx config to serve static assets in this container.
# Reverse proxy is provided by a separate `proxy` container.

EXPOSE 80

HEALTHCHECK --interval=30s --timeout=5s --retries=3 CMD wget -qO- http://localhost/ | grep -q "<html" || exit 1

CMD ["nginx", "-g", "daemon off;"]
